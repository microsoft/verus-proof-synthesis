--- benchmarks/verified-memory-allocator/unverified_nolemma/bin_sizes__idx_in_range_has_bin_size.rs

+++ benchmarks/verified-memory-allocator/unverified/bin_sizes__idx_in_range_has_bin_size.rs

@@ -101,6 +101,138 @@

     size_of_bin(bin_idx) / INTPTR_SIZE as nat
 }
 
+#[verifier::external_body]
+pub proof fn lemma_bin_sizes_constants()
+    ensures
+        size_of_bin(1) == 8, size_of_bin(1) / 8 == 1,
+        size_of_bin(2) == 16, size_of_bin(2) / 8 == 2,
+        size_of_bin(3) == 24, size_of_bin(3) / 8 == 3,
+        size_of_bin(4) == 32, size_of_bin(4) / 8 == 4,
+        size_of_bin(5) == 40, size_of_bin(5) / 8 == 5,
+        size_of_bin(6) == 48, size_of_bin(6) / 8 == 6,
+        size_of_bin(7) == 56, size_of_bin(7) / 8 == 7,
+        size_of_bin(8) == 64, size_of_bin(8) / 8 == 8,
+        size_of_bin(9) == 80, size_of_bin(9) / 8 == 10,
+        size_of_bin(10) == 96, size_of_bin(10) / 8 == 12,
+        size_of_bin(11) == 112, size_of_bin(11) / 8 == 14,
+        size_of_bin(12) == 128, size_of_bin(12) / 8 == 16,
+        size_of_bin(13) == 160, size_of_bin(13) / 8 == 20,
+        size_of_bin(14) == 192, size_of_bin(14) / 8 == 24,
+        size_of_bin(15) == 224, size_of_bin(15) / 8 == 28,
+        size_of_bin(16) == 256, size_of_bin(16) / 8 == 32,
+        size_of_bin(17) == 320, size_of_bin(17) / 8 == 40,
+        size_of_bin(18) == 384, size_of_bin(18) / 8 == 48,
+        size_of_bin(19) == 448, size_of_bin(19) / 8 == 56,
+        size_of_bin(20) == 512, size_of_bin(20) / 8 == 64,
+        size_of_bin(21) == 640, size_of_bin(21) / 8 == 80,
+        size_of_bin(22) == 768, size_of_bin(22) / 8 == 96,
+        size_of_bin(23) == 896, size_of_bin(23) / 8 == 112,
+        size_of_bin(24) == 1024, size_of_bin(24) / 8 == 128,
+        size_of_bin(25) == 1280, size_of_bin(25) / 8 == 160,
+        size_of_bin(26) == 1536, size_of_bin(26) / 8 == 192,
+        size_of_bin(27) == 1792, size_of_bin(27) / 8 == 224,
+        size_of_bin(28) == 2048, size_of_bin(28) / 8 == 256,
+        size_of_bin(29) == 2560, size_of_bin(29) / 8 == 320,
+        size_of_bin(30) == 3072, size_of_bin(30) / 8 == 384,
+        size_of_bin(31) == 3584, size_of_bin(31) / 8 == 448,
+        size_of_bin(32) == 4096, size_of_bin(32) / 8 == 512,
+        size_of_bin(33) == 5120, size_of_bin(33) / 8 == 640,
+        size_of_bin(34) == 6144, size_of_bin(34) / 8 == 768,
+        size_of_bin(35) == 7168, size_of_bin(35) / 8 == 896,
+        size_of_bin(36) == 8192, size_of_bin(36) / 8 == 1024,
+        size_of_bin(37) == 10240, size_of_bin(37) / 8 == 1280,
+        size_of_bin(38) == 12288, size_of_bin(38) / 8 == 1536,
+        size_of_bin(39) == 14336, size_of_bin(39) / 8 == 1792,
+        size_of_bin(40) == 16384, size_of_bin(40) / 8 == 2048,
+        size_of_bin(41) == 20480, size_of_bin(41) / 8 == 2560,
+        size_of_bin(42) == 24576, size_of_bin(42) / 8 == 3072,
+        size_of_bin(43) == 28672, size_of_bin(43) / 8 == 3584,
+        size_of_bin(44) == 32768, size_of_bin(44) / 8 == 4096,
+        size_of_bin(45) == 40960, size_of_bin(45) / 8 == 5120,
+        size_of_bin(46) == 49152, size_of_bin(46) / 8 == 6144,
+        size_of_bin(47) == 57344, size_of_bin(47) / 8 == 7168,
+        size_of_bin(48) == 65536, size_of_bin(48) / 8 == 8192,
+        size_of_bin(49) == 81920, size_of_bin(49) / 8 == 10240,
+        size_of_bin(50) == 98304, size_of_bin(50) / 8 == 12288,
+        size_of_bin(51) == 114688, size_of_bin(51) / 8 == 14336,
+        size_of_bin(52) == 131072, size_of_bin(52) / 8 == 16384,
+        size_of_bin(53) == 163840, size_of_bin(53) / 8 == 20480,
+        size_of_bin(54) == 196608, size_of_bin(54) / 8 == 24576,
+        size_of_bin(55) == 229376, size_of_bin(55) / 8 == 28672,
+        size_of_bin(56) == 262144, size_of_bin(56) / 8 == 32768,
+        size_of_bin(57) == 327680, size_of_bin(57) / 8 == 40960,
+        size_of_bin(58) == 393216, size_of_bin(58) / 8 == 49152,
+        size_of_bin(59) == 458752, size_of_bin(59) / 8 == 57344,
+        size_of_bin(60) == 524288, size_of_bin(60) / 8 == 65536,
+        size_of_bin(61) == 655360, size_of_bin(61) / 8 == 81920,
+        size_of_bin(62) == 786432, size_of_bin(62) / 8 == 98304,
+        size_of_bin(63) == 917504, size_of_bin(63) / 8 == 114688,
+        size_of_bin(64) == 1048576, size_of_bin(64) / 8 == 131072,
+        size_of_bin(65) == 1310720, size_of_bin(65) / 8 == 163840,
+        size_of_bin(66) == 1572864, size_of_bin(66) / 8 == 196608,
+        size_of_bin(67) == 1835008, size_of_bin(67) / 8 == 229376,
+        size_of_bin(68) == 2097152, size_of_bin(68) / 8 == 262144,
+        size_of_bin(69) == 2621440, size_of_bin(69) / 8 == 327680,
+        size_of_bin(70) == 3145728, size_of_bin(70) / 8 == 393216,
+        size_of_bin(71) == 3670016, size_of_bin(71) / 8 == 458752,
+        size_of_bin(72) == 4194304, size_of_bin(72) / 8 == 524288,
+        size_of_bin(73) == 4194312, size_of_bin(73) / 8 == 524289,
+	{
+		unimplemented!()
+	}
+
+spec fn property_idx_in_range_has_bin_size(bin_idx: int, wsize:int) -> bool
+{
+    valid_bin_idx(bin_idx) &&
+    (pfd_lower(bin_idx) <= wsize <= pfd_upper(bin_idx))
+    ==> 
+    smallest_bin_fitting_size(wsize * INTPTR_SIZE) == bin_idx
+}
+
+spec fn check_idx_in_range_has_bin_size(bin_idx: int, wsize_start:int, wsize_end:int) -> bool
+    decreases wsize_end - wsize_start,
+{
+   if wsize_start >= wsize_end {
+       true
+   } else {
+          property_idx_in_range_has_bin_size(bin_idx, wsize_start)
+       && check_idx_in_range_has_bin_size(bin_idx, wsize_start + 1, wsize_end)
+   }
+}
+
+spec fn check2_idx_in_range_has_bin_size(bin_idx_start: int, bin_idx_end: int, wsize_start:int, wsize_end:int) -> bool
+    decreases bin_idx_end - bin_idx_start,
+{
+    if bin_idx_start >= bin_idx_end {
+        true
+    } else {
+        check_idx_in_range_has_bin_size(bin_idx_start, wsize_start, wsize_end)
+        && check2_idx_in_range_has_bin_size(bin_idx_start + 1, bin_idx_end, wsize_start, wsize_end)
+    }
+}
+
+#[verifier::external_body]
+proof fn result_idx_in_range_has_bin_size(bin_idx: int, wsize_start:int, wsize_end:int)
+    ensures
+        check_idx_in_range_has_bin_size(bin_idx, wsize_start, wsize_end) ==>
+            (forall |wsize| wsize_start <= wsize < wsize_end ==>
+                 property_idx_in_range_has_bin_size(bin_idx, wsize)),
+    decreases wsize_end - wsize_start,
+{
+   unimplemented!()
+}
+
+#[verifier::external_body]
+proof fn result2_idx_in_range_has_bin_size(bin_idx_start: int, bin_idx_end: int, wsize_start:int, wsize_end:int)
+    ensures
+        check2_idx_in_range_has_bin_size(bin_idx_start, bin_idx_end, wsize_start, wsize_end) ==>
+            (forall |bin_idx,wsize| bin_idx_start <= bin_idx < bin_idx_end && wsize_start <= wsize < wsize_end ==>
+                     property_idx_in_range_has_bin_size(bin_idx, wsize)),
+    decreases bin_idx_end - bin_idx_start,
+{
+   unimplemented!()
+}
+
 pub proof fn idx_in_range_has_bin_size(bin_idx: int, wsize: int)
     requires 
         valid_bin_idx(bin_idx),
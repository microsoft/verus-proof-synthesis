# <img src="assets/logo.png" alt="Project logo" width="40" /> AutoVerus

![Framework](assets/framework.png)

This repository contains code and artifacts for the paper " AutoVerus: Automated Proof Generation for Rust Code".

* `benchmarks`. This folder contains a number of Rust/Verus proof tasks, including all the 150 proof tasks referred to as <i>Verus-Bench</i> in our tech report. Please refer to the [benchmarks README](benchmarks/README.md) for more details.
* `code`. This folder contains the python code that does proof synthesis for Verus.
* `utils/lynette`. This folder contains a Verus parser that is written to support Verus proof synthesis.
* `generated`. This folder contains the generated proofs for the benchmarks.
    * `baseline-generated`. This folder contains the generated proofs for the benchmarks using the baseline approach (directly using LLM to generate the proof).
    * `autoverus-generated`. This folder contains the generated proofs for the benchmarks using our approach.
    * `ablation-study`. This folder contains the generated proofs for the ablation study.

## A Quick Start for the artifact evaluation

```bash
docker build -t autoverus .
docker run -it autoverus /bin/bash

cd code
export OPENAI_API_KEY=<your-api-key>

# Run a small-scale experiment
python verify.py --name gpt4o-ab-sampled --config-file config-artifact-openai.json
```


## Run on your own machine

### Pre-requisites

* You need to install [Verus](https://github.com/verus-lang/verus) before using this tool
    * Checkout to the commit `33269ac6a0ea33a08109eefe5016c1fdd0ce9fbd` and build it from source
* You may need to run `cargo install verusfmt` to install the Verus formatter

Please refer to our [Dockerfile](Dockerfile) for more details.

### Setup

```bash
pip install -r requirements.txt
```

## Usage

```bash
python main.py --input <input_file> --output <output_file> --config <config_file> 
```
* `--input` specify a rust file that you want to generate Verus proof for (default: input.rs)
* `--output` specify a file that you want the final output to be written in (default: output.rs)
* `--config` specify your configuration. The format of this file is shown in config.json (default: config.json)
* `--repair` specify the number of debugging rounds before giving up (default: 10) 
There are a few other parameters that you can set. Try `python main.py -h' to know more.

In addition to the final output, you will also see a folder prefixed by `intermediate-` that contains all the intermediate files generated by LLM and by our tool.

## Important Notes

The output is inherently non-deterministic given the random nature of LLM.
